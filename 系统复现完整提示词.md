# 制程可靠性数据分析系统复现完整提示词

## 系统概述
制程可靠性数据分析系统是一个自动化数据处理和分析平台，用于检测远程服务器上的机台数据更新，并将处理后的数据存储到数据库中，同时提供前端界面进行数据查询、可视化和报告生成。

## 功能需求

### 数据类型
1. **HCI&NBTI数据**
   - 检测远程服务器更新
   - 整合CSV和Excel文件到数据库表(UNIFIED_HCI_NBTI_DATA和CSV_DATA)
   - 前端支持筛选查询和Excel导出

2. **VRDB数据**
   - 检测远程服务器更新
   - 批量导入CSV数据到VRDB_DATA表
   - 前端支持筛选查询、散点图展示和数据导出

3. **TDDB数据**
   - 检测远程服务器更新
   - 提取指定字段存入TDDB表
   - 前端支持筛选查询、散点图、Wafer热力图展示和数据导出
   - 支持一键生成标准化Word报告

## 技术架构
- 后端：Python (Flask)
- 数据库：MySQL
- 前端：HTML/CSS/JavaScript
- 数据处理：Pandas, NumPy
- 可视化：Chart.js
- 报告生成：python-docx

## 项目结构
```
project/
├── backend/          # 后端代码
│   ├── app.py        # Flask应用入口
│   ├── models/       # 数据库模型
│   ├── utils/        # 工具函数
│   └── views/        # 视图函数
├── config/           # 配置文件
├── data/             # 数据文件
├── frontend/         # 前端代码
├── reports/          # 报告文件
├── src/              # 主程序
├── .env              # 环境变量配置
├── requirements.txt  # 依赖包列表
└── README.md         # 项目说明
```

## 核心组件实现

### 1. 后端Flask应用 (backend/app.py)
```python
from flask import Flask, jsonify, request, send_file
from flask_cors import CORS
from backend.utils.database import init_database, get_db_session
from backend.models.hci_nbti_model import UnifiedHciNbtiData, CsvData
from backend.models.vrdb_model import VrdbData
from backend.models.tddb_model import TddbData
from backend.utils.report_generator import ReportGenerator
import os

def create_app():
    app = Flask(__name__)
    CORS(app)
    
    # 初始化数据库
    init_database()
    
    @app.route('/api/hci-nbti/search', methods=['GET'])
    def search_hci_nbti():
        # 实现HCI&NBTI数据查询API
        pass
    
    @app.route('/api/hci-nbti/export', methods=['GET'])
    def export_hci_nbti():
        # 实现HCI&NBTI数据导出API
        pass
    
    @app.route('/api/vrdb/search', methods=['GET'])
    def search_vrdb():
        # 实现VRDB数据查询API
        pass
    
    @app.route('/api/vrdb/export', methods=['GET'])
    def export_vrdb():
        # 实现VRDB数据导出API
        pass
    
    @app.route('/api/tddb/search', methods=['GET'])
    def search_tddb():
        # 实现TDDB数据查询API
        pass
    
    @app.route('/api/tddb/export', methods=['GET'])
    def export_tddb():
        # 实现TDDB数据导出API
        pass
    
    @app.route('/api/report/generate', methods=['POST'])
    def generate_report():
        # 实现报告生成API
        pass
    
    @app.route('/api/report/download/<filename>', methods=['GET'])
    def download_report(filename):
        # 实现报告下载API
        pass
    
    return app

if __name__ == '__main__':
    app = create_app()
    app.run(host='0.0.0.0', port=5000, debug=True)
```

### 2. 数据库模型

#### HCI&NBTI数据模型 (backend/models/hci_nbti_model.py)
```python
from sqlalchemy import Column, Integer, String, Float, DateTime, Text
from backend.utils.database import Base

class UnifiedHciNbtiData(Base):
    __tablename__ = 'unified_hci_nbti_data'
    
    id = Column(Integer, primary_key=True, autoincrement=True)
    lot_id = Column(String(50), nullable=False)
    device_id = Column(String(50), nullable=False)
    device_name = Column(String(100), nullable=True)
    std = Column(String(50), nullable=True)
    vtd = Column(Float, nullable=True)
    csv_name = Column(String(255), nullable=True)
    created_at = Column(DateTime, nullable=False)
    updated_at = Column(DateTime, nullable=False)
    
    
class CsvData(Base):
    __tablename__ = 'csv_data'
    
    id = Column(Integer, primary_key=True, autoincrement=True)
    csv_name = Column(String(255), nullable=False)
    change_range = Column(Text, nullable=True)
    created_at = Column(DateTime, nullable=False)
    updated_at = Column(DateTime, nullable=False)
```

#### VRDB数据模型 (backend/models/vrdb_model.py)
```python
from sqlalchemy import Column, Integer, String, Float, DateTime
from backend.utils.database import Base

class VrdbData(Base):
    __tablename__ = 'vrdb_data'
    
    id = Column(Integer, primary_key=True, autoincrement=True)
    device_id = Column(String(50), nullable=False)
    test_date = Column(DateTime, nullable=False)
    voltage = Column(Float, nullable=True)
    current = Column(Float, nullable=True)
    resistance = Column(Float, nullable=True)
    temperature = Column(Float, nullable=True)
    created_at = Column(DateTime, nullable=False)
    updated_at = Column(DateTime, nullable=False)
```

#### TDDB数据模型 (backend/models/tddb_model.py)
```python
from sqlalchemy import Column, Integer, String, Float, DateTime
from backend.utils.database import Base

class TddbData(Base):
    __tablename__ = 'tddb'
    
    id = Column(Integer, primary_key=True, autoincrement=True)
    device_id = Column(String(50), nullable=False)
    wafer_id = Column(String(50), nullable=False)
    x_coordinate = Column(Integer, nullable=False)
    y_coordinate = Column(Integer, nullable=False)
    value = Column(Float, nullable=True)
    test_date = Column(DateTime, nullable=False)
    created_at = Column(DateTime, nullable=False)
    updated_at = Column(DateTime, nullable=False)
```

### 3. 数据库工具 (backend/utils/database.py)
```python
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from sqlalchemy.ext.declarative import declarative_base
from config.config import DATABASE_CONFIG
import os

# 加载环境变量
from dotenv import load_dotenv
load_dotenv()

# 创建数据库引擎
engine_url = f"mysql+pymysql://{os.getenv('DB_USER', DATABASE_CONFIG['user'])}:{os.getenv('DB_PASSWORD', DATABASE_CONFIG['password'])}@{os.getenv('DB_HOST', DATABASE_CONFIG['host'])}:{os.getenv('DB_PORT', DATABASE_CONFIG['port'])}/{os.getenv('DB_NAME', DATABASE_CONFIG['database'])}?charset={DATABASE_CONFIG['charset']}"
engine = create_engine(engine_url, echo=False)

# 创建会话
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# 创建基础类
Base = declarative_base()

# 导出Base类供其他模块使用
__all__ = ['engine', 'SessionLocal', 'Base', 'get_db_session', 'init_database', 'close_database']

def get_db_session():
    return SessionLocal()

def init_database():
    # 导入所有模型以确保它们被定义
    from backend.models.hci_nbti_model import UnifiedHciNbtiData, CsvData
    from backend.models.vrdb_model import VrdbData
    from backend.models.tddb_model import TddbData
    
    # 创建所有表
    Base.metadata.create_all(bind=engine)
    

def close_database():
    engine.dispose()
```

### 4. 数据处理工具 (backend/utils/data_processor.py)
```python
import pandas as pd
import os
from datetime import datetime
from backend.utils.database import get_db_session
from backend.models.hci_nbti_model import UnifiedHciNbtiData, CsvData
from backend.models.vrdb_model import VrdbData
from backend.models.tddb_model import TddbData
from config.config import FILE_PATHS

class DataProcessor:
    def process_hci_nbti_data(self):
        # 处理HCI&NBTI数据
        pass
    
    def process_vrdb_data(self):
        # 处理VRDB数据
        pass
    
    def process_tddb_data(self):
        # 处理TDDB数据
        pass
```

### 5. 文件监控工具 (backend/utils/file_monitor.py)
```python
import os
import time
from datetime import datetime
from config.config import FILE_PATHS, TIME_CONFIG

class FileMonitor:
    def __init__(self):
        self.last_check_time = datetime.now()
    
    def check_for_updates(self):
        # 检查所有数据源文件夹是否有更新
        pass
    
    def start_monitoring(self, callback=None):
        # 开始监控
        pass
```

### 6. 报告生成工具 (backend/utils/report_generator.py)
```python
from docx import Document
from docx.shared import Inches, Pt
from docx.enum.text import WD_ALIGN_PARAGRAPH
from docx.oxml.ns import qn
from datetime import datetime
import os
from config.config import FILE_PATHS

class ReportGenerator:
    def generate_hci_nbti_report(self, data, start_date=None, end_date=None):
        # 生成HCI&NBTI分析报告
        pass
    
    def generate_vrdb_report(self, data, start_date=None, end_date=None):
        # 生成VRDB分析报告
        pass
    
    def generate_tddb_report(self, data, start_date=None, end_date=None):
        # 生成TDDB分析报告
        pass
    
    def generate_comprehensive_report(self, hci_nbti_data, vrdb_data, tddb_data, start_date=None, end_date=None):
        # 生成综合分析报告
        pass
```

### 7. 配置文件 (config/config.py)
```python
import os

# 数据库配置
DATABASE_CONFIG = {
    'host': os.getenv('DB_HOST', 'localhost'),
    'port': int(os.getenv('DB_PORT', 3306)),
    'user': os.getenv('DB_USER', 'root'),
    'password': os.getenv('DB_PASSWORD', '123456'),
    'database': os.getenv('DB_NAME', 'reliability_data'),
    'charset': 'utf8mb4'
}

# 文件路径配置
FILE_PATHS = {
    'hci_nbti_source': os.getenv('HCI_NBTI_SOURCE_PATH', '/remote/hci_nbti_data'),
    'vrdb_source': os.getenv('VRDB_SOURCE_PATH', '/remote/vrdb_data'),
    'tddb_source': os.getenv('TDDB_SOURCE_PATH', './data/tddb_data'),
    'processed_data': os.getenv('PROCESSED_DATA_PATH', './data/processed'),
    'reports': os.getenv('REPORTS_PATH', './reports')
}

# 应用配置
APP_CONFIG = {
    'secret_key': os.getenv('SECRET_KEY', 'your-secret-key'),
    'debug': os.getenv('DEBUG', 'False').lower() == 'true',
    'host': os.getenv('HOST', '0.0.0.0'),
    'port': int(os.getenv('PORT', 5000))
}

# 时间配置
TIME_CONFIG = {
    'file_check_interval': 60
}
```

### 8. 环境变量文件 (.env)
```
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=123456
DB_NAME=reliability_data
SECRET_KEY=your-secret-key
DEBUG=True
HOST=0.0.0.0
PORT=5000
CHECK_INTERVAL=300
DATA_RETENTION_DAYS=365
```

### 9. 依赖包列表 (requirements.txt)
```
Flask==2.3.2
SQLAlchemy==2.0.15
pandas==2.0.2
numpy==1.24.3
pymysql==1.1.0
openpyxl==3.1.2
python-docx==0.8.11
matplotlib==3.7.1
seaborn==0.12.2
schedule==1.2.0
python-dotenv==1.0.0
```

### 10. 主程序 (src/main.py)
```python
import sys
import os

# 将项目根目录添加到Python路径
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from backend.utils.file_monitor import FileMonitor
from backend.utils.data_processor import DataProcessor
from backend.utils.database import init_database

def process_data_updates(updates):
    processor = DataProcessor()
    
    # 根据更新类型处理数据
    if updates.get('hci_nbti', False):
        processor.process_hci_nbti_data()
        
    if updates.get('vrdb', False):
        processor.process_vrdb_data()
        
    if updates.get('tddb', False):
        processor.process_tddb_data()

def main():
    print("启动制程可靠性数据分析系统...")
    
    # 初始化数据库
    init_database()
    print("数据库初始化完成")
    
    # 创建文件监控器
    monitor = FileMonitor()
    
    # 启动监控
    monitor.start_monitoring(callback=process_data_updates)

if __name__ == "__main__":
    main()
```

### 11. 数据库检查脚本 (src/check_database.py)
```python
import sys
import os

# 添加项目根目录到Python路径
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

# 加载环境变量
from dotenv import load_dotenv
load_dotenv()

from backend.utils.database import init_database, engine
from sqlalchemy import text

def check_database():
    print("检查数据库连接...")
    
    try:
        # 测试数据库连接
        with engine.connect() as connection:
            result = connection.execute(text("SELECT 1"))
            print("数据库连接成功！")
            
        # 初始化数据库
        print("初始化数据库...")
        init_database()
        print("数据库初始化完成！")
        
    except Exception as e:
        print(f"数据库连接失败: {e}")

def main():
    check_database()

if __name__ == "__main__":
    main()
```

### 12. 测试数据生成脚本 (src/generate_test_data.py)
```python
import random
import datetime
from sqlalchemy.orm import sessionmaker
from sqlalchemy import create_engine
import sys
import os

# 添加项目根目录到Python路径
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

# 加载环境变量
from dotenv import load_dotenv
load_dotenv()

from backend.models.hci_nbti_model import UnifiedHciNbtiData, CsvData
from backend.models.tddb_model import TddbData
from backend.models.vrdb_model import VrdbData
from config.config import DATABASE_CONFIG

def generate_hci_nbti_data(session, count=100):
    # 生成HCI/NBTI模拟数据
    pass

def generate_tddb_data(session, count=500):
    # 生成TDDB模拟数据
    pass

def generate_vrdb_data(session, count=200):
    # 生成VRDB模拟数据
    pass

def main():
    print("开始生成模拟数据...")
    # 实现数据生成逻辑

if __name__ == "__main__":
    main()
```

### 13. 前端界面 (frontend/index.html)
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>制程可靠性数据分析系统</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- 实现前端界面 -->
    <script src="js/main.js"></script>
</body>
</html>
```

### 14. 前端JavaScript (frontend/js/main.js)
```javascript
// 实现前端交互逻辑
```

### 15. 前端CSS (frontend/styles/main.css)
```css
/* 实现前端样式 */
```

## 部署说明
1. 安装依赖：`pip install -r requirements.txt`
2. 配置环境变量
3. 初始化数据库：`python src/check_database.py`
4. 启动系统：
   - 数据监控服务：`python src/main.py`
   - Web服务：`python backend/app.py`
   - 前端服务：`cd frontend && python -m http.server 8000`

## 使用说明
1. 访问Web界面：http://localhost:8000
2. 数据查询：在Web界面中使用各类数据查询功能
3. 数据导出：将查询结果导出为Excel文件
4. 报告生成：在报告生成页面选择报告类型和时间范围，系统将自动生成Word格式的报告文件